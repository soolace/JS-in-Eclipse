<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>JSON - array example with parse and Iteration, innerHTML</title>
<link rel="stylesheet" type="text/css" href="style2.css">
</head>
<body onload="showList(); hideButton(); hideText()">

	<h3>a dynamic table with elements, which are in a JSON Array</h3>

	<!-- second example, create a Table with an JSON-Array -->
	<table id="toShow" border="1">
		<!-- contenteditable="true", with this, the html field is editable -->
	</table>

	<br>
	<div>
		<br> <input type="button" id="deleteButton"
			value="delete last input" onclick="deleteCar()"> <br>
		<h4>add or edit your favourite car:</h4>
		Brand: <input type="text" name="textFieldBrand" id="textFieldBrand"
			value=""> Model: <input type="text" name="textFieldModel"
			id="textFieldModel" value=""> <br> <br>
		<h4>your old Car, change it below and click on the field with the
			car</h4>
		Brand: <input type="text" name="showTextBrand" id="showTextBrand"
			value="" readonly> Model: <input type="text"
			name="showTextModel" id="showTextModel" value="" readonly><br>
		<br> <input type="button" id="editButton" value="Edit your car"
			style.display="none" onclick="editandClear()"> <br> <input
			type="button" id="button1" value="add your car"
			onclick="doAddandClear()">



	</div>


	<br>
	<h4 id="hiddenMessage" value=""></h4>


</body>

<script>
	// this example shows an array in a String
	var car = '{"cars":[{"brand":"Porsche","model":"Carrera" },'
			+ '{"brand":"Dodge","model":"Hellcat" },'
			+ '{"brand":"Chevrolet","model":"Camaro" }]}';

	let obj = JSON.parse(car);

	//creating tables and puts in the objects, same procedure like the first example
	function createStringTable() {
		var arrayLength = obj.cars.length;
		allLines = '<tr><th>Brand</th><th>Model</th></tr>';
		for (var i = 0; i < arrayLength; i++) {
			var rowId = "row_" + i;
			var lineI = '<tr id='
					+ rowId
					+ ' onmouseover="mouseOver(this.id);" onmouseout="mouseOut(this.id);" onclick="checkChilds(this.id)"><td>'
					+ obj.cars[i].brand + '</td><td>' + obj.cars[i].model
					+ '</td></tr>';
			var temp = allLines + lineI;
			allLines = temp;

		}
		return allLines; //return allLines, because its in a function and we need it in another function

	}

	//add a new car, with push and the definition, which field is for which element
	function addCar() {
		var brandValue = document.getElementById("textFieldBrand").value;
		var modelValue = document.getElementById("textFieldModel").value;
		obj.cars.push({
			brand : brandValue,
			model : modelValue
		});
		showList();

	}

	//check the children and get the nodeValue
	function checkChilds(rowId) {
		var rowNode = document.getElementById(rowId);
		var hasChild = rowNode.hasChildNodes(); //has it children? 

		if (hasChild) {
			console.log("how many: " + rowNode.childNodes.length); //how  many child are next
			let listTds = rowNode.childNodes;
			let tdBrand = listTds[0];
			let tdModel = listTds[1];
			var valueBrand = tdBrand.childNodes[0].nodeValue; //gets the value from the text-Element under the last Child
			var valueModel = tdModel.childNodes[0].nodeValue;
			setFields(valueBrand, valueModel); //calls the function and sets the values
			showButton();
			showText();
		}
	}

	//function to get a console log when the value is 1 or 3
	function showNodeInfo(node) {
		if (node.nodeType == 1) {
			console.log("Type = HTML-Element, Wert: " + node.nodeValue
					+ ", Name: " + node.nodeName);
		} else if (node.nodeType == 3) {
			console.log("Typ-Text, Name: " + node.nodeValue + ", Name: "
					+ node.nodeName);
		}

	}

	//here, the value from the node will put in the textFields
	function setFields(valueBrand, valueModel) {
		document.getElementById("showTextBrand").value = valueBrand;
		document.getElementById("showTextModel").value = valueModel;
		document.getElementById("textFieldBrand").value = valueBrand;
		document.getElementById("textFieldModel").value = valueModel;
	}

	//function to delete the last element
	function deleteCar() {
		obj.cars.pop();
		showList();
	}

	//calls the function createStringTable and shows the table and refresh
	function showList() {
		var allLines = createStringTable();
		document.getElementById("toShow").innerHTML = allLines;
	}

	//function to clear the input fields
	function clearField() {
		document.getElementById("textFieldBrand").value = '';
		document.getElementById("textFieldModel").value = '';
	}

	//functions to call both functions with one click
	function doAddandClear() {
		addCar();
		clearField();
		showTextPink();
	}

	function editandClear() {
		editButton();
		clearField();
	}

	//to change the background color when the mouse is over the element
	function changeBg() {
		//document.body.style.backgroundColor = "red"; //this changes the whole background
		document.getElementById("toShow").style.backgroundColor = "#06EEF9";

	}
	//shows a text, when the car is added
	function showTextPink() {
		document.getElementById("hiddenMessage").innerHTML = "THANKS FOR YOUR INPUT!";
		document.getElementById("hiddenMessage").style.color = "magenta";
	}

	//changes the coler of the actual row, where the mouse is
	function mouseOver(id) {
		document.getElementById(id).style.backgroundColor = "#06EEF9";
	}
	//goes back to white, when the mouse is out of the row
	function mouseOut(id) {
		document.getElementById(id).style.backgroundColor = "#FFFFFF";
	}

	//hide or show functions
	function hideButton() {
		document.getElementById("editButton").style.display = 'none';

	}

	function showButton() {
		document.getElementById("editButton").style.display = 'block';
	}

	function hideText() {
		document.getElementById("showTextBrand").style.display = 'none';
		document.getElementById("showTextModel").style.display = 'none';
	}

	function showText() {
		document.getElementById("showTextBrand").style.display = 'block';
		document.getElementById("showTextModel").style.display = 'block';
	}

	// edit the value in the textfields and replace the old one from the arrayList
	function editButton() {
		var brandOldValue = document.getElementById("showTextBrand").value;
		var modelOldValue = document.getElementById("showTextModel").value;
		var brandNewValue = document.getElementById("textFieldBrand").value;
		var modelNewValue = document.getElementById("textFieldModel").value;
		var oldCar = {
			brand : brandOldValue,
			model : modelOldValue
		};
		var newCar = {
			brand : brandNewValue,
			model : modelNewValue
		};
		var numberOfCars = obj.cars.length; //looks for the field with the same value
		for (var i = 0; i < numberOfCars; i++) {
			var carFromArray = obj.cars[i];
			var resultOfEqual = isEqual(oldCar, carFromArray);
			if (resultOfEqual) {
				var foundedIndex = i;
				obj.cars[foundedIndex] = newCar; //replaces the old field with the new value
			}
		}
		showList();
	}

	//are the two cars equal-function
	function isEqual(car1, car2) {
		brandCar1 = car1.brand;
		brandCar2 = car2.brand;
		modelCar1 = car1.model;
		modelCar2 = car2.model;
		var isEqual = false;

		if ((brandCar1 == brandCar2) && (modelCar1 == modelCar2)) {
			isEqual = true;
		}
		return isEqual;
	}
</script>

</html>